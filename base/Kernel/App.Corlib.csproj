<!--
##############################################################################
#
#   Microsoft Research Singularity
#
#   Copyright (c) Microsoft Corporation.  All rights reserved.
#
#   File:   Applications\Runtime\Makefile
#
#   Note:
#
##############################################################################
-->
<Project DefaultTarget="Build" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">

  <Import Project="..\Paths.targets"/>

  <PropertyGroup>
    <UseResponseFile>true</UseResponseFile>
    <AllowUnsafeBlocks>true</AllowUnsafeBlocks>
    <TreatWarningsAsErrors>true</TreatWarningsAsErrors>
    <ExcludeFromILReferences>false</ExcludeFromILReferences>
    <DefineConstants>SINGULARITY_PROCESS;ENDPOINT_STRUCT</DefineConstants>
    <NoWarn>169,649</NoWarn>
    <AssemblyName>Corlib</AssemblyName>
    <OutputType>Library</OutputType>
    <AssemblyEnvironment>none</AssemblyEnvironment>
    <APPRUNTIME>..\Applications\Runtime</APPRUNTIME>
    <LIBRARIES>..\Libraries</LIBRARIES>
    <Language>C#</Language>
    <NoStdLib>true</NoStdLib>
    <ProjectGuid>{F4C22616-B154-496C-A4CF-C49401E52C87}</ProjectGuid>
  </PropertyGroup>

  <Choose>
    <When Condition="'$(PAGING)'=='On'">
      <PropertyGroup>
        <DefineConstants>$(DefineConstants);PAGING</DefineConstants>
      </PropertyGroup>
    </When>
  </Choose>

  <ItemGroup>
    <Compile Include="System\ApplicationException.cs" />
    <Compile Include="System\ArgumentException.cs" />
    <Compile Include="System\ArgumentNullException.cs" />
    <Compile Include="System\ArgumentOutOfRangeException.cs" />
    <Compile Include="System\ArithmeticException.cs" />
    <Compile Include="System\ArrayTypeMismatchException.cs" />
    <Compile Include="System\DivideByZeroException.cs" />
    <Compile Include="System\Exception.cs" />
    <Compile Include="System\FormatException.cs" />
    <Compile Include="System\IndexOutOfRangeException.cs" />
    <Compile Include="System\InvalidCastException.cs" />
    <Compile Include="System\InvalidOperationException.cs" />
    <Compile Include="System\MulticastNotSupportedException.cs" />
    <Compile Include="System\NotSupportedException.cs" />
    <Compile Include="System\NullReferenceException.cs" />
    <Compile Include="System\ObjectDisposedException.cs" />
    <Compile Include="System\OutOfMemoryException.cs" />
    <Compile Include="System\OverflowException.cs" />
    <Compile Include="$(APPRUNTIME)\System\ProcessCreateException.cs" />
    <Compile Include="System\ProcessStateException.cs" />
    <Compile Include="System\RankException.cs" />
    <Compile Include="System\StackOverflowException.cs" />
    <Compile Include="System\SystemException.cs" />
    <Compile Include="System\TypeInitializationException.cs" />
    <Compile Include="System\AttributeUsageAttribute.cs" />
    <Compile Include="System\CLSCompliantAttribute.cs" />
    <Compile Include="System\FlagsAttribute.cs" />
    <Compile Include="System\ObsoleteAttribute.cs" />
    <Compile Include="System\ParamArrayAttribute.cs" />
    <Compile Include="System\ArgIterator.cs" />
    <Compile Include="System\Array.cs" />
    <Compile Include="System\AsyncCallback.cs" />
    <Compile Include="System\Attribute.cs" />
    <Compile Include="System\AttributeTargets.cs" />
    <Compile Include="System\BitConverter.cs" />
    <Compile Include="System\Boolean.cs" />
    <Compile Include="System\Buffer.cs" />
    <Compile Include="System\Byte.cs" />
    <Compile Include="System\Char.cs" />
    <Compile Include="System\CharEnumerator.cs" />
    <Compile Include="$(APPRUNTIME)\System\Console.cs" />
    <Compile Include="$(APPRUNTIME)\System\DateTime.cs" />
    <Compile Include="System\SchedulerTime.cs" />
    <Compile Include="System\DayOfWeek.cs" />
    <Compile Include="System\Decimal.cs" />
    <Compile Include="System\Delegate.cs" />
    <Compile Include="System\Double.cs" />
    <Compile Include="System\Empty.cs" />
    <Compile Include="System\Enum.cs" />
    <Compile Include="$(APPRUNTIME)\System\Environment.cs" />
    <Compile Include="System\EventArgs.cs" />
    <Compile Include="System\EventHandler.cs" />
    <Compile Include="System\Guid.cs" />
    <Compile Include="System\IAsyncResult.cs" />
    <Compile Include="System\ICloneable.cs" />
    <Compile Include="System\IComparable.cs" />
    <Compile Include="System\IDisposable.cs" />
    <Compile Include="System\IFormattable.cs" />
    <Compile Include="System\Int16.cs" />
    <Compile Include="System\Int32.cs" />
    <Compile Include="System\Int64.cs" />
    <Compile Include="System\IntPtr.cs" />
    <Compile Include="System\Internal.cs" />
    <Compile Include="System\Math.cs" />
    <Compile Include="System\MulticastDelegate.cs" />
    <Compile Include="System\Number.cs" />
    <Compile Include="System\Object.cs" />
    <Compile Include="System\ParseNumbers.cs" />
    <!-- <Compile Include="System\PrincipalId.cs"/> -->
    <Compile Include="System\ProcessExitCode.cs" />
    <Compile Include="System\Random.cs" />
    <Compile Include="System\RuntimeArgumentHandle.cs" />
    <Compile Include="System\RuntimeFieldHandle.cs" />
    <Compile Include="System\RuntimeMethodHandle.cs" />
    <Compile Include="System\RuntimeType.cs" />
    <Compile Include="System\RuntimeTypeHandle.cs" />
    <Compile Include="System\SByte.cs" />
    <Compile Include="System\Single.cs" />
    <Compile Include="System\String.cs" />
    <Compile Include="System\Text\StringBuilder.cs" />
    <Compile Include="System\TimeSpan.cs" />
    <Compile Include="System\Type.cs" />
    <Compile Include="System\TypeCode.cs" />
    <Compile Include="System\TypedReference.cs" />
    <Compile Include="System\UInt16.cs" />
    <Compile Include="System\UInt32.cs" />
    <Compile Include="System\UInt64.cs" />
    <Compile Include="System\UIntPtr.cs" />
    <Compile Include="System\ValueType.cs" />
    <Compile Include="System\VarargList.cs" />
    <Compile Include="System\Version.cs" />
    <Compile Include="System\Void.cs" />
    <Compile Include="System\_LocalDataStore.cs" />
    <Compile Include="System\_LocalDataStoreMgr.cs" />
    <Compile Include="$(LIBRARIES)\Crypto\MD5.cs" />

    <!-- THREADING_SOURCES -->
    <Compile Include="$(APPRUNTIME)\System\Threading\AutoResetEvent.cs" />
    <Compile Include="System\Threading\HandleCreateException.cs" />
    <Compile Include="System\Threading\Interlocked.cs" />
    <Compile Include="$(APPRUNTIME)\System\Threading\ManualResetEvent.cs" />
    <Compile Include="System\Threading\Monitor.cs" />
    <Compile Include="$(APPRUNTIME)\System\Threading\Mutex.cs" />
    <Compile Include="System\Threading\SynchronizationLockException.cs" />
    <Compile Include="$(APPRUNTIME)\System\Threading\Thread.cs" />
    <Compile Include="System\Threading\ThreadStart.cs" />
    <Compile Include="System\Threading\ThreadState.cs" />
    <Compile Include="System\Threading\ThreadStateException.cs" />
    <Compile Include="System\Threading\Timeout.cs" />
    <Compile Include="$(APPRUNTIME)\System\Threading\WaitHandle.cs" />
    <!-- COLLECTIONS_SOURCES -->
    <Compile Include="System\Collections\ArrayList.cs" />
    <Compile Include="System\Collections\BitArray.cs" />
    <Compile Include="System\Collections\CaseInsensitiveComparer.cs" />
    <Compile Include="System\Collections\CaseInsensitiveHashCodeProvider.cs" />
    <Compile Include="System\Collections\CollectionBase.cs" />
    <Compile Include="System\Collections\Comparer.cs" />
    <Compile Include="System\Collections\DictionaryBase.cs" />
    <Compile Include="System\Collections\DictionaryEntry.cs" />
    <Compile Include="System\Collections\Hashtable.cs" />
    <Compile Include="System\Collections\ICollection.cs" />
    <Compile Include="System\Collections\IComparer.cs" />
    <Compile Include="System\Collections\IDictionary.cs" />
    <Compile Include="System\Collections\IDictionaryEnumerator.cs" />
    <Compile Include="System\Collections\IEnumerable.cs" />
    <Compile Include="System\Collections\IEnumerator.cs" />
    <Compile Include="System\Collections\IHashCodeProvider.cs" />
    <Compile Include="System\Collections\IList.cs" />
    <Compile Include="System\Collections\Queue.cs" />
    <Compile Include="System\Collections\ReadOnlyCollectionBase.cs" />
    <Compile Include="System\Collections\SortedList.cs" />
    <Compile Include="System\Collections\Stack.cs" />
    <Compile Include="System\Collections\Specialized\ListDictionary.cs" />
    <Compile Include="System\Collections\Specialized\StringDictionary.cs" />
    <!-- DIAGNOSTICS_SOURCES -->
    <Compile Include="System\Diagnostics\Assert.cs" />
    <Compile Include="System\Diagnostics\AssertFilter.cs" />
    <Compile Include="System\Diagnostics\AssertFilters.cs" />
    <Compile Include="System\Diagnostics\ConditionalAttribute.cs" />
    <Compile Include="System\Diagnostics\Debug.cs" />
    <Compile Include="System\Diagnostics\DebuggerAttributes.cs" />
    <!-- REFLECTION_SOURCES -->
    <Compile Include="System\Reflection\Assembly.cs" />
    <Compile Include="System\Reflection\AssemblyAttributes.cs" />
    <Compile Include="System\Reflection\AssemblyName.cs" />
    <Compile Include="System\Reflection\AssemblyReflectionAttributes.cs" />
    <Compile Include="System\Reflection\DefaultMemberAttribute.cs" />
    <Compile Include="System\Reflection\Module.cs" />
    <Compile Include="System\Reflection\TypeAttributes.cs" />
    <!-- GLOBALIZATION_SOURCES -->
    <Compile Include="System\Globalization\CharacterInfo.cs" />
    <Compile Include="System\Globalization\CompareInfo.cs" />
    <Compile Include="System\Globalization\CultureInfo.cs" />
    <Compile Include="System\Globalization\NumberFormatInfo.cs" />
    <Compile Include="System\Globalization\NumberStyles.cs" />
    <Compile Include="System\Globalization\TextInfo.cs" />
    <Compile Include="System\Globalization\UnicodeCategory.cs" />
    <!-- TEXT_SOURCES -->
    <Compile Include="System\Text\ASCIIEncoding.cs" />
    <Compile Include="System\Text\Decoder.cs" />
    <Compile Include="System\Text\Encoder.cs" />
    <Compile Include="System\Text\Encoding.cs" />
    <Compile Include="System\Text\UnicodeEncoding.cs" />
    <Compile Include="System\Text\UTF8Encoding.cs" />
    <!-- REGULAR_EXPRESSIONS_SOURCES -->
    <Compile Include="System\Text\RegularExpressions\regex.cs" />
    <Compile Include="System\Text\RegularExpressions\regexboyermoore.cs" />
    <Compile Include="System\Text\RegularExpressions\regexcapture.cs" />
    <Compile Include="System\Text\RegularExpressions\regexcapturecollection.cs" />
    <Compile Include="System\Text\RegularExpressions\regexcharclass.cs" />
    <Compile Include="System\Text\RegularExpressions\regexcode.cs" />
    <Compile Include="System\Text\RegularExpressions\regexcompilationinfo.cs" />
    <Compile Include="System\Text\RegularExpressions\regexfcd.cs" />
    <Compile Include="System\Text\RegularExpressions\regexgroup.cs" />
    <Compile Include="System\Text\RegularExpressions\regexgroupcollection.cs" />
    <Compile Include="System\Text\RegularExpressions\regexinterpreter.cs" />
    <Compile Include="System\Text\RegularExpressions\regexmatch.cs" />
    <Compile Include="System\Text\RegularExpressions\regexmatchcollection.cs" />
    <Compile Include="System\Text\RegularExpressions\regexnode.cs" />
    <Compile Include="System\Text\RegularExpressions\regexoptions.cs" />
    <Compile Include="System\Text\RegularExpressions\regexparser.cs" />
    <Compile Include="System\Text\RegularExpressions\regexreplacement.cs" />
    <Compile Include="System\Text\RegularExpressions\regexrunner.cs" />
    <Compile Include="System\Text\RegularExpressions\regextree.cs" />
    <Compile Include="System\Text\RegularExpressions\regexwriter.cs" />
    <!-- COMPILER_SERVICES_SOURCES -->
    <Compile Include="System\Runtime\CompilerServices\DecimalConstantAttribute.cs" />
    <Compile Include="System\Runtime\CompilerServices\IndexerNameAttribute.cs" />
    <Compile Include="System\Runtime\CompilerServices\IsVolatile.cs" />
    <Compile Include="System\Runtime\CompilerServices\MethodImplAttribute.cs" />
    <Compile Include="System\Runtime\CompilerServices\RuntimeHelpers.cs" />
    <!-- INTEROP_SOURCES -->
    <Compile Include="System\Runtime\InteropServices\Attributes.cs" />
    <Compile Include="System\Runtime\InteropServices\CharSet.cs" />
    <Compile Include="System\Runtime\InteropServices\GCHandle.cs" />
    <Compile Include="System\Runtime\InteropServices\LayoutKind.cs" />
    <Compile Include="System\Runtime\InteropServices\Marshal.cs" />
    <!-- X86_SOURCES -->
    <Compile Include="Singularity\X86\CR0.cs" />
    <Compile Include="Singularity\X86\CR3.cs" />
    <Compile Include="Singularity\X86\CR4.cs" />
    <Compile Include="Singularity\X86\EFlags.cs" />
    <Compile Include="Singularity\X86\EVectors.cs" />
    <Compile Include="Singularity\X86\Gdt.cs" />
    <Compile Include="Singularity\X86\Idt.cs" />
    <Compile Include="Singularity\X86\MmxContext.cs" />
    <Compile Include="Singularity\X86\Pdt.cs" />
    <Compile Include="Singularity\X86\ProcessorContext.cs" />
    <Compile Include="Singularity\X86\ThreadContext.cs" />
    <Compile Include="Singularity\X86\Tss.cs" />
    <!-- CHANNEL_SOURCES -->
    <Compile Include="Singularity\Channels\ChannelClosedException.cs" />
    <Compile Include="Singularity\Channels\ChannelException.cs" />
    <Compile Include="Singularity\Channels\ChannelTransferredException.cs" />
    <Compile Include="Singularity\Channels\ClaimsAttribute.cs" />
    <Compile Include="Singularity\Channels\ISelectable.sg" />
    <Compile Include="Singularity\Channels\ITracked.cs" />
  </ItemGroup>

  <ItemGroup>
    <Compile Include="Singularity\Io\IoDma.cs" />
    <Compile Include="Singularity\Io\IoDmaRange.cs" />
    <Compile Include="$(APPRUNTIME)\Singularity\Io\IoIrq.cs" />
    <Compile Include="Singularity\Io\IoIrqRange.cs" />
    <Compile Include="Singularity\Io\IoMemoryRange.cs" />
    <Compile Include="Singularity\Io\IoPort.cs" />
    <Compile Include="Singularity\Io\IoPortRange.cs" />
    <Compile Include="Singularity\Io\IoRange.cs" />
    <Compile Include="Singularity\Io\PciConfig.cs" />
    <Compile Include="Singularity\Io\PnpConfig.cs" />
    <Compile Include="Singularity\Io\ResourceAttributes.cs" />
  </ItemGroup>

  <ItemGroup>
    <!-- IO_SOURCES -->
    <Compile Include="Singularity\Io\Access.cs" />
    <Compile Include="Singularity\Io\ByteOrder.cs" />
    <Compile Include="Singularity\Io\Error.cs" />
    <Compile Include="Singularity\Io\IoConfig.cs" />
    <Compile Include="Singularity\Io\IoMemory.cs" />
    <Compile Include="Singularity\Io\CategoryAttributes.cs" />
    <Compile Include="Singularity\Memory\PhysicalAddress.cs" />
    <!-- SA_SOURCES -->
    <Compile Include="Singularity\Security\SecurityAttributes.cs" />
    <Compile Include="$(APPRUNTIME)\Singularity\AppRuntime.cs" />
    <Compile Include="$(APPRUNTIME)\Singularity\DebugStub.cs" />
    <Compile Include="$(APPRUNTIME)\Singularity\Processor.cs" />
    <Compile Include="$(APPRUNTIME)\Singularity\Memory\Stacks.cs" />
    <Compile Include="Singularity\Tracing.cs" />
    <Compile Include="Singularity\Monitoring.cs" />
  </ItemGroup>
  <ItemGroup>
    <ProjectReference Include="$(SINGULARITY_ROOT)\Interfaces\Singularity.V1\Singularity.V1.csproj" />
    <ProjectReference Include="$(SINGULARITY_ROOT)\Interfaces\Console\Console.csproj" />
    <ProjectReference Include="$(SINGULARITY_ROOT)\Applications\Runtime\ILHelpers.csproj" />
  </ItemGroup>


  <!-- Pull in the items and properties for the GC implementation. -->
  <PropertyGroup>
    <Collector>$(COLLECTOR_APP)</Collector>
    <DefineGCCompileItems>true</DefineGCCompileItems>
  </PropertyGroup>
  <Import Project="GC.targets"/>

  <Import Project="$(SINGULARITY_ROOT)\Targets\AppRuntime.targets" />
</Project>
